---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: sharedresources.platform.platform.dev
spec:
  group: platform.platform.dev
  names:
    kind: SharedResource
    listKind: SharedResourceList
    plural: sharedresources
    singular: sharedresource
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: SharedResource is the Schema for the sharedresources API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of SharedResource
            properties:
              deletionPolicy:
                allOf:
                - enum:
                  - orphan
                  - delete
                - enum:
                  - orphan
                  - delete
                default: orphan
                description: |-
                  DeletionPolicy determines what happens to target resources when this
                  SharedResource CR is deleted.
                    - "orphan" (default): Target resources are left in place (safe)
                    - "delete": Target resources are deleted (use with caution)
                type: string
              source:
                description: |-
                  Source specifies the Secret or ConfigMap to synchronize.
                  The source resource must exist in the SAME namespace as this SharedResource CR.
                  This design ensures the team owning the secret also controls its distribution.

                  Example:
                    source:
                      kind: Secret
                      name: db-credentials
                properties:
                  kind:
                    description: |-
                      Kind specifies the type of Kubernetes resource to sync.
                      Must be either "Secret" or "ConfigMap".

                      Note: TLS secrets (type: kubernetes.io/tls) are still "Secret" kind -
                      the secret type is preserved during sync.
                    enum:
                    - Secret
                    - ConfigMap
                    type: string
                  name:
                    description: Name is the name of the source resource in the SharedResource's
                      namespace.
                    type: string
                required:
                - kind
                - name
                type: object
              syncPolicy:
                description: |-
                  SyncPolicy configures how data is copied to targets.
                  By default, all keys are copied. Use selective mode to filter specific keys.
                properties:
                  keys:
                    description: |-
                      Keys specifies which keys to include or exclude.
                      Only used when Mode is "selective".
                    properties:
                      exclude:
                        description: |-
                          Exclude lists keys to skip during sync.
                          Applied after Include filter.

                          Example: Sync everything except internal metadata
                            keys:
                              exclude:
                                - internal-metadata
                        items:
                          type: string
                        type: array
                      include:
                        description: |-
                          Include lists the keys to sync. If empty, all keys are synced.
                          When specified, ONLY these keys are copied to targets.

                          Example: Only sync username and password, not connection-string
                            keys:
                              include:
                                - username
                                - password
                        items:
                          type: string
                        type: array
                    type: object
                  mode:
                    allOf:
                    - enum:
                      - copy
                      - selective
                    - enum:
                      - copy
                      - selective
                    default: copy
                    description: |-
                      Mode determines the sync strategy:
                        - "copy" (default): Sync all keys from source to target
                        - "selective": Only sync keys specified in the Keys field
                    type: string
                type: object
              targets:
                description: |-
                  Targets lists the namespaces where the source should be synchronized.
                  Each target can optionally rename the resource in that namespace.

                  Example:
                    targets:
                      - namespace: backend
                      - namespace: jobs
                        name: database-creds  # Optional: rename in this namespace
                items:
                  description: |-
                    =============================================================================
                    TargetSpec identifies a destination namespace for synchronization.
                    =============================================================================
                  properties:
                    name:
                      description: |-
                        Name optionally overrides the resource name in the target namespace.
                        If not specified, the source resource's name is used.

                        Use case: When the target namespace already has a resource with the
                        same name, or when different naming conventions are required.
                      type: string
                    namespace:
                      description: |-
                        Namespace is the target namespace to sync the resource to.
                        The namespace must already exist - the operator will NOT create it.
                      type: string
                  required:
                  - namespace
                  type: object
                minItems: 1
                type: array
            required:
            - source
            - targets
            type: object
          status:
            description: status defines the observed state of SharedResource
            properties:
              conditions:
                description: |-
                  Conditions represent the overall state of the SharedResource.
                  Standard condition types:
                    - "Ready": True when all targets are successfully synced
                    - "SourceFound": True when the source resource exists
                    - "Degraded": True when some (but not all) targets failed to sync
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              lastSyncTime:
                description: LastSyncTime is the timestamp of the last successful
                  full sync.
                format: date-time
                type: string
              sourceChecksum:
                description: |-
                  SourceChecksum is the SHA256 hash of the source resource's data.
                  Used for drift detection - if source changes, checksum changes,
                  triggering a re-sync to all targets.
                type: string
              syncedTargets:
                description: |-
                  SyncedTargets shows the sync status for each target namespace.
                  This allows users to see which targets succeeded and which failed.
                items:
                  description: |-
                    =============================================================================
                    TargetSyncStatus tracks sync status for a single target namespace.
                    =============================================================================
                  properties:
                    error:
                      description: Error contains the error message if sync failed
                        for this target
                      type: string
                    lastSynced:
                      description: LastSynced is when this target was last successfully
                        synced
                      format: date-time
                      type: string
                    name:
                      description: Name is the resource name in the target namespace
                      type: string
                    namespace:
                      description: Namespace is the target namespace
                      type: string
                    synced:
                      description: Synced indicates whether the sync to this target
                        was successful
                      type: boolean
                  required:
                  - name
                  - namespace
                  - synced
                  type: object
                type: array
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
